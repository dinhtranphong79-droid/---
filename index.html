<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>---</title>

<style>
html,body{
  margin:0;
  background:#000;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* Khung 9:16 */
#stage{
  position:relative;
  aspect-ratio:9/16;
  height:100vh;
  max-height:100vh;
  max-width:calc(100vh * 9 / 16);
  overflow:hidden;
  background:#000;
}

/* lớp nền động */
#stage::before{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(to top, #000000, #001f3f, #220066);
  animation: bgAnimation 8s ease-in-out infinite;
  z-index:0;
}

/* canvas + chữ nằm trên nền */
canvas,
#textOverlay{
  position:relative;
  z-index:1;
}


/* Gradient animation cho bầu trời */
@keyframes bgAnimation {
  0% { background: linear-gradient(to top, #000000, #001f3f, #220066); }
  50% { background: linear-gradient(to top, #000000, #003366, #330088); }
  100% { background: linear-gradient(to top, #000000, #001f3f, #220066); }
}


/* Canvas pháo hoa */
canvas{
  width:100%;
  height:100%;
  display:block;
}

/* Chữ */
#textOverlay{
  position:absolute;
  top:50%;
  left:50%;
  width:82%;
  transform:translate(-50%,-50%) scale(.9);

  text-align:center;
  color:#ff3a3a;
  font-family:"Tahoma","Arial",sans-serif;
  font-weight:700;
  letter-spacing:2px;
  line-height:1.2;
  text-transform:uppercase;

  word-wrap:break-word;
  white-space:normal;

  pointer-events:none;
  opacity:0;

  transition:
    opacity .8s ease-out,
    transform .8s cubic-bezier(.2,.9,.3,1.2);
}
</style>
</head>

<body>

<div id="stage">
  <canvas id="c"></canvas>
  <div id="textOverlay"></div>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const textBox = document.getElementById("textOverlay");
const stage = document.getElementById("stage");

let W=0,H=0;
const starsFar = [];
const starsNear = [];
function createStar(layer) {
  return {
    x: Math.random() * W,
    y: Math.random() * H,
    r: layer === "far" ? Math.random() * 1.2 : Math.random() * 2,
    opacity: Math.random(),
    vx: layer === "far" ? (Math.random() - 0.5) * 0.05 : (Math.random() - 0.5) * 0.15,
    vy: layer === "far" ? 0.05 : 0.15
  };
}


function resize(){
  const rect = stage.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;
  W = rect.width;
  H = rect.height;

  // reset sao
  starsFar.length = 0;
  starsNear.length = 0;

  for (let i = 0; i < 120; i++) starsFar.push(createStar("far"));
  for (let i = 0; i < 70; i++) starsNear.push(createStar("near"));
}


 

  



resize();
window.addEventListener("resize", resize);

/* --------------------- FIREWORK SYSTEM --------------------- */

const particles=[];
const rockets = [];

function rand(a,b){return Math.random()*(b-a)+a;}
function launchFirework(x) {
  rockets.push({
    x: x,
    y: H + 10,        // bắt đầu từ dưới màn hình
    vy: -rand(6, 9),  // bay lên
    targetY: rand(H * 0.2, H * 0.45),
    exploded: false
  });
}

function spawnFirework(x,y,color){
  const count = 150;
  for(let i=0;i<count;i++){
    const angle = Math.random()*2*Math.PI;
    const speed = Math.random()*4+1;
    particles.push({
      x,y,
      vx: Math.cos(angle)*speed,
      vy: Math.sin(angle)*speed,
      life: rand(50,90),
      c: color
    });
  }
}

function burstAroundText(){
  const cx=W/2;
  const cy=H/2 - 40;
  for(let i=0;i<6;i++){
    setTimeout(()=>spawnFirework(
      cx+rand(-120,120),
      cy+rand(-80,80),
      ["#ffcc33","#ff5555","#ffaa00","#ffffff"][Math.floor(rand(0,4))]
    ), i*200);
  }
}

function randomSkyFirework(){
  launchFirework(rand(W * 0.2, W * 0.8));
}

function drawStars(){
  for(let s of starsFar){
    s.x += s.vx;
    s.y += s.vy;

    if(s.x < 0) s.x = W;
    if(s.x > W) s.x = 0;
    if(s.y > H) s.y = 0;

    s.opacity += (Math.random()-0.5)*0.01;
    s.opacity = Math.max(0, Math.min(1, s.opacity));

    ctx.fillStyle = `rgba(180,200,255,${s.opacity})`;
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
    ctx.fill();
  }

  for(let s of starsNear){
    s.x += s.vx;
    s.y += s.vy;

    if(s.x < 0) s.x = W;
    if (s.x > W) s.x = -10;
if (s.y > H) s.y = -10;


    s.opacity += (Math.random()-0.5)*0.03;
    s.opacity = Math.max(0, Math.min(1, s.opacity));

    ctx.fillStyle = `rgba(255,255,255,${s.opacity})`;
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
    ctx.fill();
  }
}





function draw(){
  ctx.clearRect(0, 0, W, H);

drawStars();
// Vẽ rocket bay lên
for (let i = rockets.length - 1; i >= 0; i--) {
  const r = rockets[i];
  r.y += r.vy;

  ctx.fillStyle = "#fff";
  ctx.fillRect(r.x, r.y, 2, 8);

  if (r.y <= r.targetY && !r.exploded) {
    spawnFirework(
      r.x,
      r.y,
      ["#ffcc33", "#ff5555", "#ffaa00", "#ffffff"][Math.floor(rand(0,4))]
    );
    r.exploded = true;
    rockets.splice(i, 1);
  }
}
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    p.x+=p.vx;
    p.y+=p.vy;
    p.vy+=0.03;
    p.life--;

    ctx.fillStyle=p.c;
    ctx.fillRect(p.x,p.y,2,2);

    if(p.life<=0) particles.splice(i,1);
  }

  requestAnimationFrame(draw);
}
draw();

/* ---------------- TEXT SEQUENCE ---------------- */

const messages = [
  "BÌNH AN BẮT ĐẦU...", 
  "YÊU THƯƠNG LAN TỎA...", 
  "HẠNH PHÚC ĐONG ĐẦY...", 
  "HAPPY NEW YEAR 2026"
];

let index = 0;

function showMessage(text){
  textBox.innerText = text;

  // Nếu là dòng cuối → chữ to hơn
  if (text.includes("2026")) {
    textBox.style.fontSize = "2.2em";
  } else {
    textBox.style.fontSize = "1.6em";
  }
if(text.includes("2026")){
  textBox.style.textShadow = "0 0 40px gold";
}

  textBox.style.opacity = 0;
  textBox.style.transform = "translate(-50%,-50%) scale(.8)";

  setTimeout(() => {
    textBox.style.opacity = 1;
    textBox.style.transform = "translate(-50%,-50%) scale(1)";
  }, 60);

  burstAroundText();
}


function cycleMessages(){
  if(index>=messages.length) return;

  showMessage(messages[index]);

  setTimeout(()=>{
    textBox.style.opacity=0;
    index++;
    setTimeout(cycleMessages,600);
  }, 3000); // thời gian đọc chữ 3s
}

/* Giai đoạn đầu: pháo hoa ngẫu nhiên */
let delay = 500;
let introCount = 0;
let intro = setInterval(()=>{
    randomSkyFirework();
    introCount++;
    if(introCount%3==0) delay = Math.max(150, delay-20); // dồn dần
}, delay);


/* Sau 6s -> chuyển sang chữ */
setTimeout(()=>{
  clearInterval(intro);
  cycleMessages();
}, 6000);

</script>
</body>
</html>
